<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>廖雪峰SQL | ZDK&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="SQL">
    <meta name="description" content="概述NoSQL数据库，也就是非SQL的数据库，包括MongoDB、Cassandra、Dynamo等等，它们都不是关系数据库。有很多人鼓吹现代Web程序已经无需关系数据库了，只需要使用NoSQL就可以。但事实上，SQL数据库从始至终从未被取代过。今天，SQL数据库仍然承担了各种应用程序的核心数据存储，而NoSQL数据库作为SQL数据库的补充，两者不再是二选一的问题，而是主从关系。所以，无论使用哪种">
<meta name="keywords" content="SQL">
<meta property="og:type" content="article">
<meta property="og:title" content="廖雪峰SQL">
<meta property="og:url" content="https://github.com/zdkswd/2019/02/03/廖雪峰SQL/index.html">
<meta property="og:site_name" content="ZDK&#39;s blog">
<meta property="og:description" content="概述NoSQL数据库，也就是非SQL的数据库，包括MongoDB、Cassandra、Dynamo等等，它们都不是关系数据库。有很多人鼓吹现代Web程序已经无需关系数据库了，只需要使用NoSQL就可以。但事实上，SQL数据库从始至终从未被取代过。今天，SQL数据库仍然承担了各种应用程序的核心数据存储，而NoSQL数据库作为SQL数据库的补充，两者不再是二选一的问题，而是主从关系。所以，无论使用哪种">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.01.20.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.02.13.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.24.10.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.53.44.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.54.14.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.57.22.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.59.43.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.02.10.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.10.26.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.10.49.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.11.30.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.21.36.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.25.58.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.26.27.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.27.45.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.31.30.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.32.05.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.44.03.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.46.45.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.52.36.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.53.54.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.04.09.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.04.40.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.06.05.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.10.24.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.16.03.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.16.47.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.17.18.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.19.10.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.19.41.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.25.07.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.27.18.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.27.25.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.34.42.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.34.57.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.39.42.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.41.52.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.43.02.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.44.42.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.48.40.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%202.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%203.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%204.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.54.00.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.54.22.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.55.57.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.57.05.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.58.50.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.59.16.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.59.49.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.03.05.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.04.36.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.04.58.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.12.02.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.12.48.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.16.12.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.18.09.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.22.58.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.23.43.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.24.08.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.25.32.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.28.54.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.31.28.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.34.20.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.38.40.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.43.13.png">
<meta property="og:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.56.48.png">
<meta property="og:updated_time" content="2019-02-03T05:25:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="廖雪峰SQL">
<meta name="twitter:description" content="概述NoSQL数据库，也就是非SQL的数据库，包括MongoDB、Cassandra、Dynamo等等，它们都不是关系数据库。有很多人鼓吹现代Web程序已经无需关系数据库了，只需要使用NoSQL就可以。但事实上，SQL数据库从始至终从未被取代过。今天，SQL数据库仍然承担了各种应用程序的核心数据存储，而NoSQL数据库作为SQL数据库的补充，两者不再是二选一的问题，而是主从关系。所以，无论使用哪种">
<meta name="twitter:image" content="https://github.com/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.01.20.png">
    
        <link rel="alternate" type="application/atom+xml" title="ZDK&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/tmg.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">ZDK</h5>
          <a href="mailto:2822464407@qq.com" title="2822464407@qq.com" class="mail">2822464407@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zdkswd" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">廖雪峰SQL</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">廖雪峰SQL</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-02-03T05:22:32.000Z" itemprop="datePublished" class="page-time">
  2019-02-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/教程/">教程</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#关系模型"><span class="post-toc-number">2.</span> <span class="post-toc-text">关系模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#主键"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">主键</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#联合主键"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">联合主键</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#外键"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">外键</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多对多"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">多对多</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一对一"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">一对一</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#索引"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">索引</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#唯一索引"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">唯一索引</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#查询数据"><span class="post-toc-number">3.</span> <span class="post-toc-text">查询数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本查询"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">基本查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#条件查询"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">条件查询</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常用的条件表达式"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">常用的条件表达式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#投影查询"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">投影查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#排序"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">排序</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分页查询"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">分页查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#聚合查询"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">聚合查询</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分组"><span class="post-toc-number">3.6.1.</span> <span class="post-toc-text">分组</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多表查询"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">多表查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连接查询"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">连接查询</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#修改数据"><span class="post-toc-number">4.</span> <span class="post-toc-text">修改数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#INSERT"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">INSERT</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#UPDATE"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">UPDATE</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DELETE"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">DELETE</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#实用SQL语句"><span class="post-toc-number">5.</span> <span class="post-toc-text">实用SQL语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插入或替换"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">插入或替换</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插入或更新"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">插入或更新</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插入或忽略"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">插入或忽略</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#快照"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">快照</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#写入查询结果集"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">写入查询结果集</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#事务"><span class="post-toc-number">6.</span> <span class="post-toc-text">事务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#隔离级别"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">隔离级别</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Read-Uncommitted"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">Read Uncommitted</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Read-Committed"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">Read Committed</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Repeatable-Read"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">Repeatable Read</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Serializable"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">Serializable</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#默认隔离级别"><span class="post-toc-number">6.6.</span> <span class="post-toc-text">默认隔离级别</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-廖雪峰SQL"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">廖雪峰SQL</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-02-03 13:22:32" datetime="2019-02-03T05:22:32.000Z"  itemprop="datePublished">2019-02-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/教程/">教程</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>NoSQL数据库，也就是非SQL的数据库，包括MongoDB、Cassandra、Dynamo等等，它们都不是关系数据库。有很多人鼓吹现代Web程序已经无需关系数据库了，只需要使用NoSQL就可以。但事实上，SQL数据库从始至终从未被取代过。今天，SQL数据库仍然承担了各种应用程序的核心数据存储，而NoSQL数据库作为SQL数据库的补充，两者不再是二选一的问题，而是主从关系。所以，无论使用哪种编程语言，无论是Web开发、游戏开发还是手机开发，掌握SQL，是所有软件开发人员所必须的。</p>
<p>数据库作为一种专门管理数据的软件就出现了。应用程序不需要自己管理数据，而是通过数据库软件提供的接口来读写数据。至于数据本身如何存储到文件，那是数据库软件的事情，应用程序自己并不关心。</p>
<p>数据库按照数据结构来组织，存储和管理数据，数据库一共有三种模型。层次模型，网状模型，关系模型。关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表。</p>
<p>随着时间的推移和市场竞争，最终，基于关系模型的关系数据库获得了绝对市场份额。因为相比层次模型和网状模型，关系模型理解和使用起来最简单。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.01.20.png" alt=""><br>通过给定一个班级名称，可以查到一条班级记录，根据班级ID，又可以查到多条学生记录，这样，二维表之间就通过ID映射建立了“一对多”关系。</p>
<p>数据类型<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.02.13.png" alt=""><br>表中列举了最常用的数据类型。很多数据类型还有别名，例如，REAL又可以写成FLOAT(24)。还有一些不常用的数据类型，例如，TINYINT（范围在0~255）。各数据库厂商还会支持特定的数据类型，例如JSON。</p>
<p>选择数据类型的时候，要根据业务规则选择合适的类型。通常来说，BIGINT能满足整数存储的需求，VARCHAR(N)能满足字符串存储的需求，这两种类型是使用最广泛的。</p>
<p><strong>主流关系数据库</strong><br>目前主流关系数据库分为：</p>
<ol>
<li>商用数据库，例如：Oracle，SQL Server，DB2等；</li>
<li>开源数据库，例如：MySQL，PostgreSQL等；</li>
<li>桌面数据库，以微软Access为代表，适合桌面应用程序使用；</li>
<li>嵌入式数据库，以Sqlite为代表，适合手机应用和桌面程序。</li>
</ol>
<p><strong>SQL</strong><br>SQL已经被ANSI组织定义为标准，不幸地是，各个不同的数据库对标准的SQL支持不太一致。并且，大部分数据库都在标准的SQL上做了扩展。也就是说，如果只使用标准SQL，理论上所有数据库都可以支持，但如果使用某个特定数据库的扩展SQL，换一个数据库就不能执行了。例如，Oracle把自己扩展的SQL称为PL/SQL，Microsoft把自己扩展的SQL称为T-SQL。</p>
<p>SQL语言关键字不区分大小写！！！但是，针对不同的数据库，对于表名和列名，有的数据库区分大小写，有的数据库不区分大小写。同一个数据库，有的在Linux上区分大小写，有的在Windows上不区分大小写。本文做出约定：SQL关键字总是大写，以示突出，表名和列名均使用小写。</p>
<p><strong>MySQL</strong><br>MySQL是目前应用最广泛的开源关系数据库。MySQL经过几次收购就变成了Oracle旗下的产品。和其他关系数据库有所不同的是，MySQL本身实际上只是一个SQL接口，它的内部还包含了多种数据引擎，常用的包括：</p>
<ol>
<li>InnoDB：由Innobase Oy公司开发的一款支持事务的数据库引擎，2006年被Oracle收购；</li>
<li>MyISAM：MySQL早期集成的默认数据库引擎，不支持事务。</li>
</ol>
<p>MySQL接口和数据库引擎的关系就好比某某浏览器和浏览器引擎（IE引擎或Webkit引擎）的关系。对用户而言，切换浏览器引擎不影响浏览器界面，切换MySQL引擎不影响自己写的应用程序使用MySQL的接口。</p>
<p>使用MySQL时，不同的表还可以使用不同的数据库引擎。如果你不知道应该采用哪种引擎，记住总是选择InnoDB就好了。</p>
<p>由于MySQL是开源的，所以还有其衍生版本。</p>
<h1 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h1><p>关系数据库是建立在关系模型上的。而关系模型本质上就是若干个存储数据的二维表，可以把它们看作很多Excel表。</p>
<p>表的每一行称为记录（Record），记录是一个逻辑意义上的数据。表的每一列称为字段（Column），同一个表的每一行记录都拥有相同的若干字段。</p>
<p>字段定义了数据类型（整型、浮点型、字符串、日期等），以及是否允许为NULL。注意NULL表示字段数据不存在。一个整型字段如果为NULL不表示它的值为0，同样的，一个字符串型字段为NULL也不表示它的值为空串’’。</p>
<p><strong>通常情况下，字段应该避免允许为NULL。不允许为NULL可以简化查询条件，加快查询速度，也利于应用程序读取数据后无需判断是否为NULL。</strong></p>
<p>和Excel表有所不同的是，关系数据库的表和表之间需要建立“一对多”，“多对一”和“一对一”的关系，这样才能够按照应用程序的逻辑来组织和存储数据。</p>
<p>在关系数据库中，关系是通过<strong>主键</strong>和<strong>外键</strong>来维护的。</p>
<h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><p>对于关系表，有个很重要的约束，就是任意两条记录不能重复。不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一区分出不同的记录，这个字段被称为<strong>主键</strong>。</p>
<p>由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。</p>
<p>所以，选取主键的一个基本原则是：<strong>不使用任何业务相关的字段作为主键</strong>。</p>
<p>因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。作为主键最好是完全业务无关的字段，我们一般把这个字段命名为id。常见的可作为id字段的类型有：</p>
<ol>
<li>自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；</li>
<li>全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。</li>
</ol>
<p>对于大部分应用来说，通常自增类型的主键就能满足需求。我们在students表中定义的主键也是BIGINT NOT NULL AUTO_INCREMENT类型。如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。</p>
<h3 id="联合主键"><a href="#联合主键" class="headerlink" title="联合主键"></a>联合主键</h3><p>关系数据库实际上还允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为联合主键。对于联合主键，允许一列有重复，只要不是所有主键列都重复即可：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8A%E5%8D%8811.24.10.png" alt=""><br>id_num和id_type这两列作为联合主键。<strong>没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升。</strong></p>
<h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><p>在students表中，通过class_id的字段，可以把数据与另一张表关联起来，这种列称为<strong>外键</strong>。<br>students表：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.53.44.png" alt=""><br>classes表：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.54.14.png" alt=""><br>为了表达这种一对多的关系，我们需要在students表中加入一列class_id，让它的值与classes表的某条记录相对应。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.57.22.png" alt=""><br>在students表中，通过class_id的字段，可以把数据与另一张表关联起来，这种列称为<strong>外键</strong>。外键并不是通过列名实现的，而是通过定义外键约束实现的：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%887.59.43.png" alt=""><br>其中，外键约束的名称fk_class_id可以任意，FOREIGN KEY (class_id)指定了class_id作为外键，REFERENCES classes (id)指定了这个外键将关联到classes表的id列（即classes表的主键）。</p>
<p>通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果classes表不存在id=99的记录，students表就无法插入class_id=99的记录。</p>
<p><strong>由于外键约束会降低数据库的性能</strong>，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，class_id仅仅是一个普通的列，只是它起到了外键的作用而已。</p>
<p>要删除一个外键约束，也是通过ALTER TABLE实现的：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.02.10.png" alt=""><br>注意：删除外键约束并没有删除外键这一列。删除列是通过DROP COLUMN …实现的。</p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>通过一个表的外键关联到另一个表，我们可以定义出一对多关系。有些时候，还需要定义“多对多”关系。多对多关系实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系，就形成了多对多关系。</p>
<p>多对多关系实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系，就形成了多对多关系：<br>teacher表：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.10.26.png" alt=""><br>classes表：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.10.49.png" alt=""><br>中间表teacher_class关联两个一对多关系：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.11.30.png" alt=""><br>通过中间表，我们就定义了一个“多对多”关系。</p>
<h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p>一对一关系是指，一个表的记录对应到另一个表的唯一一个记录。</p>
<p>例如，students表的每个学生可以有自己的联系方式，如果把联系方式存入另一个表contacts，我们就可以得到一个“一对一”关系：这里一对一的前提是student_id不重复。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.21.36.png" alt=""><br>既然是一对一关系，那为啥不给students表增加一个mobile列，来合二为一。</p>
<p>如果业务允许，完全可以把两个表合为一个表。一对一关系准确地说，是contacts表一对一对应students表。</p>
<p>还有一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得更高的性能。例如，把一个大的用户表分拆为用户基本信息表user_info和用户详细信息表user_profiles，大部分时候，只需要查询user_info表，并不需要查询user_profiles表，这样就提高了查询速度。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。</p>
<p>索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。</p>
<p>例如，对于students表：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.25.58.png" alt=""><br>如果要经常根据score列进行查询，就可以对score列创建索引：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.26.27.png" alt=""><br>使用ADD INDEX idx_score (score)就创建了一个名称为idx_score，使用列score的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.27.45.png" alt=""><br>索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。</p>
<p>可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。</p>
<p>对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。</p>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.31.30.png" alt=""><br>通过UNIQUE关键字我们就添加了一个唯一索引。也可以只对某一列添加一个唯一约束而不创建唯一索引。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.32.05.png" alt=""><br>这种情况下，name列没有索引，但仍然具有唯一性保证。</p>
<p>无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。</p>
<h1 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h1><h2 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h2><p>假设表名是students，要查询students表的所有行，我们用如下SQL语句：</p>
<blockquote>
<p>SELECT * FROM students;  </p>
</blockquote>
<p>使用SELECT <em> FROM students时，SELECT是关键字，表示将要执行一个查询，</em> 表示“所有列”，FROM表示将要从哪个表查询，本例中是students表。该SQL将查询出students表的所有数据。注意：查询结果也是一个<strong>二维表</strong>，它包含列名和每一行的数据。</p>
<p>不带FROM子句的SELECT语句有一个有用的用途，就是用来判断当前到数据库的连接是否有效。许多检测工具会执行一条SELECT 1;来测试数据库连接。</p>
<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><blockquote>
<p>SELECT * FROM &lt;表名&gt; WHERE &lt;条件表达式&gt;  </p>
</blockquote>
<p>条件表达式可以用&lt;条件1&gt; AND &lt;条件2&gt;表达满足条件1并且满足条件2。例如，符合条件“分数在80分或以上”，并且还符合条件“男生”，把这两个条件写出来：</p>
<ol>
<li>根据score列的数据判断：score &gt;= 80</li>
<li>根据gender列的数据判断：gender = ‘M’，注意gender列存储的是字符串，需要用单引号括起来。</li>
</ol>
<p><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.44.03.png" alt=""><br>除了AND以外，还有NOT以及OR。如果不加括号，条件运算按照NOT、AND、OR的优先级进行，即NOT优先级最高，其次是AND，最后是OR。加上括号可以改变优先级。</p>
<h3 id="常用的条件表达式"><a href="#常用的条件表达式" class="headerlink" title="常用的条件表达式"></a>常用的条件表达式</h3><p><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.46.45.png" alt=""><br>%表示0个到多个，_ 表示1个。</p>
<h2 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a>投影查询</h2><p>如果我们只希望返回某些列的数据，而不是所有列的数据，我们可以用SELECT 列1, 列2, 列3 FROM …，让结果集仅包含指定列。这种操作称为投影查询。例如，从students表中返回id、score和name这三列。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.52.36.png" alt=""><br>这样返回的结果集就只包含了我们指定的列，并且，结果集的列的顺序和原表可以不一样。</p>
<p>使用SELECT 列1, 列2, 列3 FROM …时，还可以给每一列起个别名，这样，结果集的列名就可以与原表的列名不同。它的语法是SELECT 列1 别名1, 列2 别名2, 列3 别名3 FROM …。</p>
<p>例如，以下SELECT语句将列名score重命名为points，而id和name列名保持不变：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%888.53.54.png" alt=""><br>投影查询同样可以接WHERE条件，实现复杂的查询。</p>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>我们使用SELECT查询时，细心的读者可能注意到，查询结果集通常是按照id排序的，也就是根据主键排序。这也是大部分数据库的做法。如果我们要根据其他条件排序怎么办？可以加上ORDER BY子句。例如按照成绩从低到高进行排序：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.04.09.png" alt=""><br>如果要反过来，按照成绩从高到底排序，我们可以加上DESC表示“倒序”：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.04.40.png" alt=""><br>默认的排序规则是ASC：“升序”，即从小到大。ASC可以省略，即ORDER BY score ASC和ORDER BY score效果一样。</p>
<p>如果有WHERE子句，那么ORDER BY子句要放到WHERE子句后面。例如，查询一班的学生成绩，并按照倒序排序：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.06.05.png" alt=""></p>
<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p>使用SELECT查询时，如果结果集数据量很大，比如几万行数据，放在一个页面显示的话数据量太大，不如分页显示，每次显示100条。</p>
<p>要实现分页功能，实际上就是从结果集中显示第1~100条记录作为第1页，显示第101~200条记录作为第2页，以此类推。</p>
<p>因此，分页实际上就是从结果集中“截取”出第M~N条记录。这个查询可以通过LIMIT <m> OFFSET <n>子句实现。我们先把所有学生按照成绩从高到低进行排序，把结果集分页，每页3条记录。要获取第1页的记录，可以使用LIMIT 3 OFFSET 0：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.10.24.png" alt=""><br>上述查询LIMIT 3 OFFSET 0表示，对结果集从0号记录开始，最多取3条。注意SQL记录集的索引从0开始。如果要查询第2页，那么我们只需要“跳过”头3条记录，也就是对结果集从3号记录开始查询，把OFFSET设定为3：类似的，查询第3页的时候，OFFSET应该设定为6:由于第4页只有1条记录，因此最终结果集按实际数量1显示。LIMIT 3表示的意思是“最多3条记录”。</n></m></p>
<p>OFFSET超过了查询的最大数量并不会报错，而是得到一个空的结果集。<br>OFFSET是可选的，如果只写LIMIT 15，那么相当于LIMIT 15 OFFSET 0。</p>
<p>在MySQL中，LIMIT 15 OFFSET 30还可以简写成LIMIT 30, 15。使用LIMIT <m> OFFSET <n>分页时，随着N越来越大，查询效率也会越来越低。</n></m></p>
<h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><p>对于统计总数、平均数这类计算，SQL提供了专门的聚合函数，使用聚合函数进行查询，就是聚合查询，它可以快速获得结果。仍然以查询students表一共有多少条记录为例，我们可以使用SQL内置的COUNT()函数查询。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.16.03.png" alt=""><br>COUNT( <em> )表示查询所有列的行数，要注意聚合的计算结果虽然是一个数字，但查询的结果仍然是一个二维表，只是这个二维表只有一行一列，并且列名是COUNT( </em> )。</p>
<p>通常，使用聚合查询时，我们应该给列名设置一个别名，便于处理结果。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.16.47.png" alt=""></p>
<p>COUNT(*)和COUNT(id)实际上是一样的效果。另外注意，聚合查询同样可以使用WHERE条件，因此我们可以方便地统计出有多少男生、多少女生、多少80分以上的学生等：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.17.18.png" alt=""><br>除了COUNT()函数外，SQL还提供了如下聚合函数：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.19.10.png" alt=""><br>注意，MAX()和MIN()函数并不限于数值类型。如果是字符类型，MAX()和MIN()会返回排序最后和排序最前的字符。</p>
<p>要统计男生的平均成绩，我们用下面的聚合查询：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.19.41.png" alt=""></p>
<p>要特别注意：如果聚合查询的WHERE条件没有匹配到任何行，COUNT()会返回0，而MAX()、MIN()、MAX()和MIN()会返回NULL。</p>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p>对于聚合查询，SQL还提供了“分组聚合”的功能。我们观察下面的聚合查询：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.25.07.png" alt=""><br>执行这个查询，COUNT()的结果不再是一个，而是3个，这是因为，GROUP BY子句指定了按class_id分组，因此，执行该SELECT语句时，会把class_id相同的列先分组，再分别计算，因此，得到了3行结果。</p>
<p>但是这3行结果分别是哪三个班级的，不好看出来，所以我们可以把class_id列也放入结果集中：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.27.18.png" alt=""><br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.27.25.png" alt=""><br><strong>聚合查询的列中，只能放入分组的列。</strong><br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.34.42.png" alt=""><br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.34.57.png" alt=""></p>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>SELECT查询不但可以从一张表查询数据，还可以从多张表同时查询数据。查询多张表的语法是：SELECT * FROM &lt;表1&gt; &lt;表2&gt;。</p>
<p>同时从students表和classes表的“乘积”，即查询数据，可以这么写：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.39.42.png" alt=""><br>这种一次查询两个表的数据，查询的结果也是一个二维表，它是students表和classes表的“乘积”，即students表的每一行与classes表的每一行都两两拼在一起返回。结果集的列数是students表和classes表的列数之和，行数是students表和classes表的行数之积。</p>
<p>这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有100行记录的表进行笛卡尔查询将返回1万条记录，对两个各自有1万行记录的表进行笛卡尔查询将返回1亿条记录。<strong>使用多表查询可以获取M x N行记录；多表查询的结果集可能非常巨大，要小心使用。</strong></p>
<p>查询的结果集有两列id和两列name，两列id是因为其中一列是students表的id，而另一列是classes表的id，但是在结果集中，不好区分。两列name同理</p>
<p>要解决这个问题，我们仍然可以利用投影查询的“设置列的别名”来给两个表各自的id和name列起别名：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.41.52.png" alt=""><br>注意，多表查询时，要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。但是，用表名.列名这种方式列举两个表的所有列实在是很麻烦，所以SQL还允许给表设置一个别名，让我们在投影查询中引用起来稍微简洁一点：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.43.02.png" alt=""><br>注意到FROM子句给表设置别名的语法是FROM &lt;表名1&gt; &lt;别名1&gt;, &lt;表名2&gt; &lt;别名2&gt;。这样我们用别名s和c分别表示students表和classes表。</p>
<p>多表查询也是可以添加WHERE条件的。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.44.42.png" alt=""></p>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>连接查询是另一种类型的多表查询。连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。</p>
<p>例如，我们想要选出students表的所有学生信息，可以用一条简单的SELECT语句完成，假设我们希望结果集同时包含所在班级的名称，上面的结果集只有class_id列，缺少对应班级的name列。存放班级名称的name列存储在classes表中，只有根据students表的class_id，找到classes表对应的行，再取出name列，就可以获得班级名称。</p>
<p>连接查询就派上了用场。我们先使用最常用的一种内连接——INNER JOIN来实现。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-01%20%E4%B8%8B%E5%8D%889.48.40.png" alt=""><br>INNER JOIN查询的写法是：</p>
<ol>
<li>先确定主表，仍然使用FROM &lt;表1&gt;的语法；</li>
<li>再确定需要连接的表，使用INNER JOIN &lt;表2&gt;的语法；</li>
<li>然后确定连接条件，使用ON &lt;条件…&gt;，这里的条件是s.class_id = c.id，表示students表的class_id列与classes表的id列相同的行需要连接；</li>
<li>可选：加上WHERE子句、ORDER BY等子句。</li>
</ol>
<p>使用别名不是必须的，但可以更好地简化查询语句。有内连接（INNER JOIN）就有外连接（OUTER JOIN）。</p>
<p>有RIGHT OUTER JOIN，就有LEFT OUTER JOIN，以及FULL OUTER JOIN。它们的区别是：</p>
<p>INNER JOIN只返回同时存在于两张表的行数据，由于students表的class_id包含1，2，3，classes表的id包含1，2，3，4，所以，INNER JOIN根据条件s.class_id = c.id返回的结果集仅包含1，2，3。</p>
<p>RIGHT OUTER JOIN返回右表都存在的行。如果某一行仅在右表存在，那么结果集就会以NULL填充剩下的字段。</p>
<p>LEFT OUTER JOIN则返回左表都存在的行。如果我们给students表增加一列，并添加class_id=5，由于classes表并不存在id=5的列，所以，LEFT OUTER JOIN的结果会增加一列，对应的class_name是NULL。</p>
<p>inner join<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l.png" alt=""></p>
<p>left outer join<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%202.png" alt=""></p>
<p>right outer join<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%203.png" alt=""></p>
<p>full outer join<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/l%204.png" alt=""></p>
<h1 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h1><h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><p>插入数据基本语法：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.54.00.png" alt=""></p>
<p><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.54.22.png" alt=""><br>如果一个字段有默认值，那么在INSERT语句中也可以不出现。</p>
<p>要注意，字段顺序不必和数据库表的字段顺序一致，但值的顺序必须和字段顺序一致。也就是说，可以写INSERT INTO students (score, gender, name, class_id) …，但是对应的VALUES就得变成(80, ‘M’, ‘大牛’, 2)。</p>
<p>还可以一次性添加多条记录，只需要在VALUES子句中指定多个记录值，每个记录是由(…)包含的一组值：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.55.57.png" alt=""></p>
<h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><p>更新数据库表中的记录，我们就必须使用UPDATE语句。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.57.05.png" alt=""><br>例如，我们想更新students表id=1的记录的name和score这两个字段，先写出UPDATE students SET name=’大牛’, score=66，然后在WHERE子句中写出需要更新的行的筛选条件id=1：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.58.50.png" alt=""></p>
<p>UPDATE语句的WHERE条件和SELECT语句的WHERE条件其实是一样的，因此完全可以一次更新多条记录：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.59.16.png" alt=""></p>
<p>在UPDATE语句中，更新字段时可以使用表达式。例如，把所有80分以下的同学的成绩加10分：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8A%E5%8D%8811.59.49.png" alt=""></p>
<p><strong>如果WHERE条件没有匹配到任何记录，UPDATE语句不会报错，也不会有任何记录被更新。要特别小心的是，UPDATE语句可以没有WHERE条件，这时，整个表的所有记录都会被更新。</strong></p>
<p><strong>所以，在执行UPDATE语句时要非常小心，最好先用SELECT语句来测试WHERE条件是否筛选出了期望的记录集，然后再用UPDATE更新。</strong></p>
<p>在使用MySQL这类真正的关系数据库时，UPDATE语句会返回更新的行数以及WHERE条件匹配的行数。</p>
<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><p>删除数据库表中的记录，我们可以使用DELETE语句。<br>基本语法是：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.03.05.png" alt=""></p>
<p><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.04.36.png" alt=""><br>DELETE语句的WHERE条件也是用来筛选需要删除的行，因此和UPDATE类似，DELETE语句也可以一次删除多条记录：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.04.58.png" alt=""><br>如果WHERE条件没有匹配到任何记录，DELETE语句不会报错，也不会有任何记录被删除。<strong>要特别小心的是，和UPDATE类似，不带WHERE条件的DELETE语句会删除整个表的数据。</strong></p>
<p>整个表的所有记录都会被删除。所以，在执行DELETE语句时也要非常小心，最好先用SELECT语句来测试WHERE条件是否筛选出了期望的记录集，然后再用DELETE删除。</p>
<p>在使用MySQL这类真正的关系数据库时，DELETE语句也会返回删除的行数以及WHERE条件匹配的行数。</p>
<h1 id="实用SQL语句"><a href="#实用SQL语句" class="headerlink" title="实用SQL语句"></a>实用SQL语句</h1><h2 id="插入或替换"><a href="#插入或替换" class="headerlink" title="插入或替换"></a>插入或替换</h2><p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就先删除原记录，再插入新记录。此时，可以使用REPLACE语句，这样就不必先查询，再决定是否先删除再插入。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.12.02.png" alt=""><br>若id=1的记录不存在，REPLACE语句将插入新记录，否则，当前id=1的记录将被删除，然后再插入新记录。</p>
<h2 id="插入或更新"><a href="#插入或更新" class="headerlink" title="插入或更新"></a>插入或更新</h2><p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就更新该记录，此时，可以使用INSERT INTO … ON DUPLICATE KEY UPDATE …语句：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.12.48.png" alt=""><br>若id=1的记录不存在，INSERT语句将插入新记录，否则，当前id=1的记录将被更新，更新的字段由UPDATE指定。</p>
<h2 id="插入或忽略"><a href="#插入或忽略" class="headerlink" title="插入或忽略"></a>插入或忽略</h2><p>如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就啥事也不干直接忽略，此时，可以使用INSERT IGNORE INTO …语句。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.16.12.png" alt=""><br>若id=1的记录不存在，INSERT语句将插入新记录，否则，不执行任何操作。</p>
<h2 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h2><p>如果想要对一个表进行快照，即复制一份当前表的数据到一个新表，可以结合CREATE TABLE和SELECT。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.18.09.png" alt=""><br>新创建的表结构和SELECT使用的表结构完全一致。</p>
<h2 id="写入查询结果集"><a href="#写入查询结果集" class="headerlink" title="写入查询结果集"></a>写入查询结果集</h2><p>如果查询结果集需要写入到表中，可以结合INSERT和SELECT，将SELECT语句的结果集直接插入到指定表中。</p>
<p>例如，创建一个统计成绩的表statistics，记录各班的平均成绩：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.22.58.png" alt=""><br>可以用一条语句写入各班的平均成绩：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.23.43.png" alt=""><br>确保INSERT语句的列和SELECT语句的列能一一对应，就可以在statistics表中直接保存查询的结果：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.24.08.png" alt=""></p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>在执行SQL语句的时候，某些业务要求，一系列操作必须全部执行，而不能仅执行一部分。例如，一个转账操作：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.25.32.png" alt=""><br>这两条SQL语句必须全部执行，或者，由于某些原因，如果第一条语句成功，第二条语句失败，就必须全部撤销。</p>
<p>这种把多条语句作为一个整体进行操作的功能，被称为数据库<strong>事务</strong>。数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。</p>
<p>数据库事务有ACID这4个特性。</p>
<ol>
<li>A：Atomic，原子性，将所有SQL作为原子工作单元执行，要么全部执行，要么全部不执行；</li>
<li>C：Consistent，一致性，事务完成后，所有数据的状态都是一致的，即A账户只要减去了100，B账户则必定加上了100；</li>
<li>I：Isolation，隔离性，如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离；</li>
<li>D：Duration，持久性，即事务完成后，对数据库数据的修改被持久化存储。</li>
</ol>
<p>对于单条SQL语句，数据库系统自动将其作为一个事务执行，这种事务被称为<strong>隐式事务</strong>。</p>
<p>要手动把多条SQL语句作为一个事务执行，使用<strong>BEGIN</strong>开启一个事务，使用<strong>COMMIT</strong>提交一个事务，这种事务被称为<strong>显式事务</strong>，例如，把上述的转账操作作为一个显式事务：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.28.54.png" alt=""><br>很显然多条SQL语句要想作为一个事务执行，就必须使用显式事务。</p>
<p><strong>COMMIT</strong>是指提交事务，即试图把事务内的所有SQL所做的修改永久保存。如果<strong>COMMIT</strong>语句执行失败了，整个事务也会失败。</p>
<p>有些时候，我们希望主动让事务失败，这时，可以用ROLLBACK回滚事务，整个事务会失败：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.31.28.png" alt=""><br>数据库事务是由数据库系统保证的，我们只需要根据业务逻辑使用它就可以。</p>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p>对于两个并发执行的事务，如果涉及到操作同一条记录的时候，可能会发生问题。因为并发操作会带来数据的不一致性，包括脏读、不可重复读、幻读等。数据库系统提供了隔离级别来让我们有针对性地选择事务的隔离级别，避免数据不一致的问题。</p>
<p>SQL标准定义了4种隔离级别，分别对应可能出现的数据不一致的情况：<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.34.20.png" alt=""></p>
<h2 id="Read-Uncommitted"><a href="#Read-Uncommitted" class="headerlink" title="Read Uncommitted"></a>Read Uncommitted</h2><p>Read Uncommitted是隔离级别最低的一种事务级别。在这种隔离级别下，一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据，这就是脏读（Dirty Read）。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.38.40.png" alt=""><br>事务B两次读到的数据不一致。</p>
<h2 id="Read-Committed"><a href="#Read-Committed" class="headerlink" title="Read Committed"></a>Read Committed</h2><p>在Read Committed隔离级别下，一个事务可能会遇到不可重复读（Non Repeatable Read）的问题。</p>
<p>不可重复读是指，在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致。</p>
<p>表中数据现在为Alice。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.43.13.png" alt=""></p>
<h2 id="Repeatable-Read"><a href="#Repeatable-Read" class="headerlink" title="Repeatable Read"></a>Repeatable Read</h2><p>在Repeatable Read隔离级别下，一个事务可能会遇到幻读（Phantom Read）的问题。</p>
<p>幻读是指，在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了。幻读就是没有读到的记录，以为不存在，但其实是可以更新成功的，并且，更新成功后，再次读取，就出现了。<br><img src="/img/media/%E5%BB%96%E9%9B%AA%E5%B3%B0SQL/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-02-03%20%E4%B8%8B%E5%8D%8812.56.48.png" alt=""><br>事务B在第3步第一次读取id=99的记录时，读到的记录为空，说明不存在id=99的记录。随后，事务A在第4步插入了一条id=99的记录并提交。事务B在第6步再次读取id=99的记录时，读到的记录仍然为空，但是，事务B在第7步试图更新这条不存在的记录时，竟然成功了，并且，事务B在第8步再次读取id=99的记录时，记录出现了。</p>
<p>Repeatable Read下在同一个事务内的查询都是与事务开始时刻一致，所以在B事务过程中是不会读到期间A中insert的值的。</p>
<h2 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h2><p>Serializable是最严格的隔离级别。在Serializable隔离级别下，所有事务按照次序依次执行，因此，脏读、不可重复读、幻读都不会出现。</p>
<p>虽然Serializable隔离级别下的事务具有最高的安全性，但是，由于事务是串行执行，所以效率会大大下降，应用程序的性能会急剧降低。如果没有特别重要的情景，一般都不会使用Serializable隔离级别。</p>
<h2 id="默认隔离级别"><a href="#默认隔离级别" class="headerlink" title="默认隔离级别"></a>默认隔离级别</h2><p>如果没有指定隔离级别，数据库就会使用默认的隔离级别。在MySQL中，如果使用InnoDB，默认的隔离级别是Repeatable Read。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-02-03T05:25:44.000Z" itemprop="dateUpdated">2019-02-03 13:25:44</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://github.com/zdkswd">
            <img src="/img/tmg.jpg" alt="ZDK">
            ZDK
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/">SQL</a></li></ul>


            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/02/04/鸟哥 Linux账号管理/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">鸟哥 Linux账号管理</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/01/30/Shell Scripts/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Shell Scripts</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "QiU7UFIdgTTauFTk89N47mQS-gzGzoHsz",
            appKey: "gkBx5soQkBREmER84PWbNJeM",
            avatar: "mm",
            placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>ZDK &copy; 2017 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
    <span id="busuanzi_container_site_uv">
        本站访客数<span id="busuanzi_value_site_uv"></span>人次
      </span>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'zdk'blog';
            clearTimeout(titleTime);
        } else {
            document.title = '';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
